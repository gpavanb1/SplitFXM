<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Finite-Volume Schemes - splitfxm</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../assets/docs.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Finite-Volume Schemes";
        var mkdocs_page_input_path = "flux.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> splitfxm
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../start/">Getting Started</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../benchmark/">Benchmark</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../pricing/">Pricing</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Code Documentation</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../api/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../model/">Model</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../domain/">Domain</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ic/">Initial Conditions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bc/">Boundary Conditions</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Finite-Volume Schemes</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#splitfxm.flux">flux</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#splitfxm.flux.minmod">minmod</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#splitfxm.flux.fluxes">fluxes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#splitfxm.flux.diffusion_fluxes">diffusion_fluxes</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Finite-Difference Schemes</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../derivatives/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../generate/">Scheme Generation</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../visualize/">Visualization</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../refine/">Adaptive Mesh Refinement</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Internals</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../internals/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cell/">Cell</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../boundary/">Boundary</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../system/">System</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../simulation/">Simulation</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">splitfxm</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Code Documentation</li>
      <li class="breadcrumb-item active">Finite-Volume Schemes</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="finite-volume-schemes">Finite-Volume Schemes</h1>
<p>This section contains details related to the implementation of finite-volume schemes</p>


<div class="doc doc-object doc-module">



<a id="splitfxm.flux"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="splitfxm.flux.minmod" class="doc doc-heading">
            <code class="highlight language-python">minmod(a, b)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute the minmod of two values, a and b.</p>
<p>The minmod function is a slope limiter used in high-resolution schemes
(like MUSCL) to prevent non-physical oscillations in numerical solutions
of hyperbolic PDEs</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>a</code></b>
                  (<code>float or <span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>First value or array of values.</p>
              </div>
            </li>
            <li>
              <b><code>b</code></b>
                  (<code>float or <span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>Second value or array of values.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>float or <span title="numpy.ndarray">ndarray</span></code>
              –
              <div class="doc-md-description">
                <p>The minmod value, which is either the smaller magnitude of a or b
if they have the same sign, or zero otherwise.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>splitfxm/flux.py</code></summary>
              <pre class="highlight"><code class="language-python">def minmod(a, b):
    """
    Compute the minmod of two values, a and b.

    The minmod function is a slope limiter used in high-resolution schemes
    (like MUSCL) to prevent non-physical oscillations in numerical solutions
    of hyperbolic PDEs

    Parameters
    ----------
    a : float or numpy.ndarray
        First value or array of values.
    b : float or numpy.ndarray
        Second value or array of values.

    Returns
    -------
    float or numpy.ndarray
        The minmod value, which is either the smaller magnitude of a or b
        if they have the same sign, or zero otherwise.
    """
    a = np.asarray(a)
    b = np.asarray(b)

    # Compute the sign of a and b
    sign_a = np.sign(a)
    sign_b = np.sign(b)

    # Compute minmod element-wise
    minmod_result = np.where(sign_a == sign_b, sign_a *
                             np.minimum(np.abs(a), np.abs(b)), 0)

    return minmod_result</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="splitfxm.flux.fluxes" class="doc doc-heading">
            <code class="highlight language-python">fluxes(F, cell_sub, scheme)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate the fluxes for a given stencil and numerical scheme.</p>
<p>This function calculates the west and east fluxes for a given stencil
of cells, using the specified finite volume scheme. The scheme determines
how the fluxes are computed, such as using upwind differencing, central
differencing, or more advanced schemes like QUICK, MUSCL, ENO, or WENO.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>F</code></b>
                  (<code>function</code>)
              –
              <div class="doc-md-description">
                <p>The flux function, which defines the relationship between the values
of the conserved quantities and their fluxes.</p>
              </div>
            </li>
            <li>
              <b><code>cell_sub</code></b>
                  (<code>list of Cell</code>)
              –
              <div class="doc-md-description">
                <p>The stencil of cells over which the fluxes are calculated.
Typically, this list contains 3 or more cells.</p>
              </div>
            </li>
            <li>
              <b><code>scheme</code></b>
                  (<code><span title="splitfxm.schemes.FVSchemes">FVSchemes</span></code>)
              –
              <div class="doc-md-description">
                <p>The finite volume scheme to use for flux calculations.
Available options include:
- LAX_FRIEDRICHS: Lax-Friedrichs scheme
- UPWIND: Upwind differencing scheme
- CENTRAL: Central differencing scheme
- LAX_WENDROFF: Lax-Wendroff scheme
- QUICK: Quadratic upwind interpolation
- BQUICK: Bounded QUICK scheme
- MUSCL: Monotonic Upwind Scheme for Conservation Laws
- ENO: Essentially Non-Oscillatory scheme
- WENO: Weighted Essentially Non-Oscillatory scheme</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>tuple of numpy.ndarray</code>
              –
              <div class="doc-md-description">
                <p>The west (Fw) and east (Fe) fluxes computed using the given scheme.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="splitfxm.error.SFXM">SFXM</span></code>
              –
              <div class="doc-md-description">
                <p>If the stencil size is not appropriate for the chosen scheme.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<details class="note" open>
  <summary>Notes</summary>
  <p>Each scheme has its own method of calculating fluxes:
- LAX_FRIEDRICHS: Uses a central average with a diffusive term.
- UPWIND: Chooses fluxes based on the direction of the flow.
- CENTRAL: Takes a simple average of fluxes at the cell interfaces.
- LAX_WENDROFF: Uses a Taylor series expansion to improve accuracy.
- QUICK: A 3rd-order upwind-biased scheme.
- BQUICK: A bounded version of QUICK to prevent oscillations.
- MUSCL: Uses a slope limiter to prevent non-physical oscillations.
- ENO: Selects the smoothest stencil for flux calculation.
- WENO: A higher-order extension of ENO using weighted averages.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>splitfxm/flux.py</code></summary>
              <pre class="highlight"><code class="language-python">def fluxes(F, cell_sub, scheme):
    """
    Calculate the fluxes for a given stencil and numerical scheme.

    This function calculates the west and east fluxes for a given stencil
    of cells, using the specified finite volume scheme. The scheme determines
    how the fluxes are computed, such as using upwind differencing, central
    differencing, or more advanced schemes like QUICK, MUSCL, ENO, or WENO.

    Parameters
    ----------
    F : function
        The flux function, which defines the relationship between the values
        of the conserved quantities and their fluxes.
    cell_sub : list of Cell
        The stencil of cells over which the fluxes are calculated.
        Typically, this list contains 3 or more cells.
    scheme : FVSchemes
        The finite volume scheme to use for flux calculations.
        Available options include:
        - LAX_FRIEDRICHS: Lax-Friedrichs scheme
        - UPWIND: Upwind differencing scheme
        - CENTRAL: Central differencing scheme
        - LAX_WENDROFF: Lax-Wendroff scheme
        - QUICK: Quadratic upwind interpolation
        - BQUICK: Bounded QUICK scheme
        - MUSCL: Monotonic Upwind Scheme for Conservation Laws
        - ENO: Essentially Non-Oscillatory scheme
        - WENO: Weighted Essentially Non-Oscillatory scheme

    Returns
    -------
    tuple of numpy.ndarray
        The west (Fw) and east (Fe) fluxes computed using the given scheme.

    Raises
    ------
    SFXM
        If the stencil size is not appropriate for the chosen scheme.

    Notes
    -----
    Each scheme has its own method of calculating fluxes:
    - LAX_FRIEDRICHS: Uses a central average with a diffusive term.
    - UPWIND: Chooses fluxes based on the direction of the flow.
    - CENTRAL: Takes a simple average of fluxes at the cell interfaces.
    - LAX_WENDROFF: Uses a Taylor series expansion to improve accuracy.
    - QUICK: A 3rd-order upwind-biased scheme.
    - BQUICK: A bounded version of QUICK to prevent oscillations.
    - MUSCL: Uses a slope limiter to prevent non-physical oscillations.
    - ENO: Selects the smoothest stencil for flux calculation.
    - WENO: A higher-order extension of ENO using weighted averages.
    """

    if len(cell_sub) != stencil_sizes.get(scheme):
        raise SFXM(
            f"Improper stencil size. Expected {stencil_sizes.get(scheme)}, got {len(cell_sub)}")

    ul = cell_sub[0].values()
    uc = cell_sub[1].values()
    ur = cell_sub[2].values()

    if scheme == FVSchemes.LAX_FRIEDRICHS:
        # Lax-Friedrichs scheme
        Fl = F(ul)
        Fr = F(uc)
        u_diff = uc - ul
        sigma = 0.1  # TODO: Evaluate spectral radius
        Fw = 0.5 * (Fl + Fr) - 0.5 * sigma * u_diff

        Fl = F(uc)
        Fr = F(ur)
        u_diff = ur - uc
        Fe = 0.5 * (Fl + Fr) - 0.5 * sigma * u_diff

    elif scheme == FVSchemes.UPWIND:
        # Upwind scheme
        if np.all(uc &gt; 0):
            Fw = F(ul)
        else:
            Fw = F(uc)

        if np.all(ur &gt; 0):
            Fe = F(uc)
        else:
            Fe = F(ur)

    elif scheme == FVSchemes.CENTRAL:
        # Central differencing scheme
        Fw = 0.5 * (F(ul) + F(uc))
        Fe = 0.5 * (F(uc) + F(ur))

    elif scheme == FVSchemes.LAX_WENDROFF:
        # Lax-Wendroff scheme
        Fl = F(ul)
        Fr = F(uc)
        Fw = Fl + 0.5 * (uc - ul) * (Fr - Fl)

        Fl = F(uc)
        Fr = F(ur)
        Fe = Fl + 0.5 * (ur - uc) * (Fr - Fl)

    elif scheme == FVSchemes.QUICK:
        # QUICK Scheme (3rd-order upwind)
        ul = cell_sub[0].values()
        um = cell_sub[1].values()
        ur = cell_sub[2].values()
        # Quadratic interpolation at the face
        Fw = (3/8) * F(ul) + (6/8) * F(um) - (1/8) * F(ur)

        ul = cell_sub[1].values()
        um = cell_sub[2].values()
        ur = cell_sub[3].values()
        Fe = (3/8) * F(ul) + (6/8) * F(um) - (1/8) * F(ur)

    elif scheme == FVSchemes.BQUICK:
        # BQUICK Scheme (Bounded QUICK)
        # This requires a limiter to avoid oscillations near discontinuities.
        ul = cell_sub[0].values()
        um = cell_sub[1].values()
        ur = cell_sub[2].values()

        Fw = np.clip((3/8) * F(ul) + (6/8) * F(um) -
                     (1/8) * F(ur), F(ul), F(ur))

        ul = cell_sub[1].values()
        um = cell_sub[2].values()
        ur = cell_sub[3].values()
        Fe = np.clip((3/8) * F(ul) + (6/8) * F(um) -
                     (1/8) * F(ur), F(ul), F(ur))

    elif scheme == FVSchemes.MUSCL:
        # MUSCL (Monotonic Upwind Scheme for Conservation Laws)
        ul = cell_sub[0].values()
        um = cell_sub[1].values()
        ur = cell_sub[2].values()

        slope = minmod(um - ul, ur - um)
        Fw = F(um - 0.5 * slope)
        Fe = F(um + 0.5 * slope)

    elif scheme == FVSchemes.ENO:
        # ENO (Essentially Non-Oscillatory Scheme)
        ul = cell_sub[0].values()
        um = cell_sub[1].values()
        ur = cell_sub[2].values()
        us = cell_sub[3].values()

        # ENO chooses the smoothest stencil, basic implementation for 2nd-order
        diff1 = um - ul
        diff2 = ur - um
        diff3 = us - ur

        # Check smoothest region based on divided differences
        if np.all(abs(diff2 - diff1) &lt; abs(diff3 - diff2)):
            Fw = F(ul)
        else:
            Fw = F(um)

        Fe = F(ur)

    elif scheme == FVSchemes.WENO:
        # WENO (Weighted Essentially Non-Oscillatory Scheme)
        ul = cell_sub[0].values()
        um = cell_sub[1].values()
        ur = cell_sub[2].values()
        us = cell_sub[3].values()

        # WENO coefficients for a simple 5th-order WENO scheme
        beta0 = 13/12 * (ul - 2*um + ur)**2 + 1/4 * (ul - 4*um + 3*ur)**2
        beta1 = 13/12 * (um - 2*ur + us)**2 + 1/4 * (um - us)**2
        epsilon = 1e-6
        alpha0 = 1 / (epsilon + beta0)**2
        alpha1 = 1 / (epsilon + beta1)**2
        w0 = alpha0 / (alpha0 + alpha1)
        w1 = alpha1 / (alpha0 + alpha1)

        Fw = w0 * F(ul) + w1 * F(um)
        Fe = w0 * F(ur) + w1 * F(us)

    return Fw, Fe</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="splitfxm.flux.diffusion_fluxes" class="doc doc-heading">
            <code class="highlight language-python">diffusion_fluxes(D, cell_sub, scheme)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate the diffusion fluxes of a given stencil.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>D</code></b>
                  (<code>function</code>)
              –
              <div class="doc-md-description">
                <p>The diffusion function.</p>
              </div>
            </li>
            <li>
              <b><code>cell_sub</code></b>
                  (<code>list of Cell</code>)
              –
              <div class="doc-md-description">
                <p>The stencil.</p>
              </div>
            </li>
            <li>
              <b><code>scheme</code></b>
              –
              <div class="doc-md-description">
                <p>The finite-volume scheme to use. Defaults to central scheme for now.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>tuple of numpy.ndarray</code>
              –
              <div class="doc-md-description">
                <p>The west and east diffusion fluxes.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>splitfxm/flux.py</code></summary>
              <pre class="highlight"><code class="language-python">def diffusion_fluxes(D, cell_sub, scheme):
    """
    Calculate the diffusion fluxes of a given stencil.

    Parameters
    ----------
    D : function
        The diffusion function.
    cell_sub : list of Cell
        The stencil.
    scheme: FVSchemes
        The finite-volume scheme to use. Defaults to central scheme for now.

    Returns
    -------
    tuple of numpy.ndarray
        The west and east diffusion fluxes.
    """
    if len(cell_sub) != stencil_sizes.get(scheme):
        raise SFXM(
            f"Improper stencil size. Expected {stencil_sizes.get(scheme)}, got {len(cell_sub)}")

    # Only central scheme for diffusion fluxes
    # West Flux
    ul = cell_sub[0].values()
    uc = cell_sub[1].values()
    Dl = D(ul)
    Dr = D(uc)
    dxw = 0.5 * (cell_sub[1].x() - cell_sub[0].x())
    Dw = (Dr - Dl) / dxw

    # East Flux
    uc = cell_sub[1].values()
    ur = cell_sub[2].values()
    Dl = D(uc)
    Dr = D(ur)
    dxe = 0.5 * (cell_sub[2].x() - cell_sub[1].x())
    De = (Dr - Dl) / dxe

    return Dw, De</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../bc/" class="btn btn-neutral float-left" title="Boundary Conditions"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../derivatives/" class="btn btn-neutral float-right" title="Overview">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../bc/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../derivatives/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
