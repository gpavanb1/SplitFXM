<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Boundary Conditions - splitfxm</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../assets/docs.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Boundary Conditions";
        var mkdocs_page_input_path = "bc.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> splitfxm
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../start/">Getting Started</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../benchmark/">Benchmark</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../pricing/">Pricing</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Code Documentation</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../api/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../model/">Model</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../domain/">Domain</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ic/">Initial Conditions</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Boundary Conditions</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#splitfxm.bc">bc</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#splitfxm.bc.apply_BC">apply_BC</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#splitfxm.bc.get_periodic_bcs">get_periodic_bcs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#splitfxm.bc.extend_band">extend_band</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../flux/">Finite-Volume Schemes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Finite-Difference Schemes</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../derivatives/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../generate/">Scheme Generation</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../visualize/">Visualization</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Tutorials</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../tutorials/advection_diffusion/">Advection-Diffusion</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tutorials/sod_shock/">Sod Shock Tube</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../refine/">Adaptive Mesh Refinement</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Internals</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../internals/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cell/">Cell</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../boundary/">Boundary</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../system/">System</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../simulation/">Simulation</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">splitfxm</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Code Documentation</li>
      <li class="breadcrumb-item active">Boundary Conditions</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="boundary-conditions">Boundary Conditions</h1>
<p>One of the key advantages of using this solver is that boundary conditions can be defined using a simple dictionary on either side of the domain.</p>
<p>The sparse Jacobian is automatically generated according to the boundary condition specified.</p>


<div class="doc doc-object doc-module">



<a id="splitfxm.bc"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="splitfxm.bc.apply_BC" class="doc doc-heading">
            <code class="highlight language-python">apply_BC(d, v, bc={'left': 'periodic', 'right': 'periodic'}, xmin=0.0, xmax=1.0)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Apply boundary conditions to the given domain.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>d</code></b>
                  (<code><a class="autorefs autorefs-internal" title="splitfxm.domain.Domain" href="../domain/#splitfxm.domain.Domain">Domain</a></code>)
              –
              <div class="doc-md-description">
                <p>The domain to apply the boundary conditions to.</p>
              </div>
            </li>
            <li>
              <b><code>v</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the variable to apply the boundary conditions to.</p>
              </div>
            </li>
            <li>
              <b><code>bc</code></b>
                  (<code>str</code>, default:
                      <code>{&#39;left&#39;: &#39;periodic&#39;, &#39;right&#39;: &#39;periodic&#39;}</code>
)
              –
              <div class="doc-md-description">
                <p>The type of boundary condition to apply. Acceptable values are "periodic" and "outflow". Default is "periodic".</p>
              </div>
            </li>
            <li>
              <b><code>xmin</code></b>
                  (<code>float</code>, default:
                      <code>0.0</code>
)
              –
              <div class="doc-md-description">
                <p>The minimum x-value of the domain. Default is 0.0.</p>
              </div>
            </li>
            <li>
              <b><code>xmax</code></b>
                  (<code>float</code>, default:
                      <code>1.0</code>
)
              –
              <div class="doc-md-description">
                <p>The maximum x-value of the domain. Default is 1.0.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>NotImplementedError</code>
              –
              <div class="doc-md-description">
                <p>If an unsupported boundary condition is specified.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>splitfxm/bc.py</code></summary>
              <pre class="highlight"><code class="language-python">def apply_BC(d: Domain, v: str, bc: dict = {"left": "periodic", "right": "periodic"}, xmin=0.0, xmax=1.0):
    """
    Apply boundary conditions to the given domain.

    Parameters
    ----------
    d : Domain
        The domain to apply the boundary conditions to.
    v : str
        The name of the variable to apply the boundary conditions to.
    bc : str, optional
        The type of boundary condition to apply. Acceptable values are "periodic" and "outflow". Default is "periodic".
    xmin : float, optional
        The minimum x-value of the domain. Default is 0.0.
    xmax : float, optional
        The maximum x-value of the domain. Default is 1.0.

    Raises
    ------
    NotImplementedError
        If an unsupported boundary condition is specified.
    """

    # Get cells
    cells = d.cells()

    # Find index of component
    idx = d.component_index(v)

    # Common values used in all types
    ilo = d.ilo()
    ihi = d.ihi()

    lb, rb = d.boundaries()

    # Check only required directions specified
    bc_keys = sorted(list(bc.keys()))
    if bc_keys != [btype_map[btype.LEFT], btype_map[btype.RIGHT]]:
        raise SFXM("Incorrect boundary directions specified")

    # Iterate over left and right BCs
    for dir in bc_keys:
        bc_type = bc[dir]

        if bc_type == "periodic":
            if dir == btype_map[btype.LEFT]:
                # left boundary
                # Ghost cells are (right to left) the rightmost elements (same order)
                for i, b in enumerate(lb):
                    shift = xmax - cells[ihi - (i + 1)].x()
                    b.set_x(xmin - shift)
                    b.set_value(idx, cells[ihi - i].value(idx))

            elif dir == btype_map[btype.RIGHT]:
                # right boundary
                # Ghost cells are (left to right) the leftmost elements (same order)
                for i, b in enumerate(rb):
                    shift = cells[(i + 1) + ilo].x() - xmin
                    b.set_x(xmax + shift)
                    b.set_value(idx, cells[i + ilo].value(idx))

        elif bc_type == "outflow":
            if dir == btype_map[btype.LEFT]:
                # left boundary
                for i, b in enumerate(lb):
                    # The shift mirrors the interior on the same side
                    shift = cells[(i + 1) + ilo].x() - xmin
                    b.set_x(xmin - shift)
                    # Value same as extrapolated from interior
                    dy = cells[ilo + 1].value(idx) - cells[ilo].value(idx)
                    dx = cells[ilo + 1].x() - cells[ilo].x()
                    delta_x = cells[ilo - i].x() - cells[ilo - (i + 1)].x()

                    b.set_value(
                        idx, cells[ilo - i].value(idx) - (dy/dx) * delta_x)

            elif dir == btype_map[btype.RIGHT]:
                # right boundary
                for i, b in enumerate(rb):
                    # The shift mirrors the interior on the same side
                    shift = xmax - cells[ihi - (i + 1)].x()
                    b.set_x(xmax + shift)
                    # Value same as extrapolated from interior
                    dy = cells[ihi].value(idx) - cells[ihi - 1].value(idx)
                    dx = cells[ihi].x() - cells[ihi - 1].x()
                    delta_x = cells[ihi + (i + 1)].x() - cells[ihi + i].x()

                    b.set_value(
                        idx, cells[ihi + i].value(idx) + (dy/dx) * delta_x)

        # Dictionary-based boundary conditions
        # Dirichlet and Neumann BCs require additional values also
        elif isinstance(bc_type, dict) and len(bc_type.keys()) == 1:
            bc_data = list(bc_type.values())[0]
            bc_type = list(bc_type.keys())[0]

            # Check if BC data is valid
            if not isinstance(bc_data, (float, int)):
                raise SFXM(
                    "Incorrect data specified for dictionary-type boundaries")

            if bc_type == "neumann":
                if dir == btype_map[btype.LEFT]:
                    # left boundary
                    neumann_value = bc_data
                    for i, b in enumerate(lb):
                        # The shift mirrors the interior on the same side
                        shift = cells[(i + 1) + ilo].x() - xmin
                        b.set_x(xmin - shift)

                        # Cell width to the left
                        dx = cells[ilo - i].x() - cells[ilo - (i + 1)].x()
                        b.set_value(
                            idx, cells[ilo - i].value(idx) - neumann_value * dx)

                elif dir == btype_map[btype.RIGHT]:
                    # right boundary
                    neumann_value = bc_data
                    for i, b in enumerate(rb):
                        # The shift mirrors the interior on the same side
                        shift = xmax - cells[ihi - (i + 1)].x()
                        b.set_x(xmax + shift)

                        # Cell width to the right
                        dx = cells[ihi + (i + 1)].x() - cells[ihi + i].x()
                        b.set_value(
                            idx, cells[ihi + i].value(idx) + neumann_value * dx)

            elif bc_type == "dirichlet":
                if dir == btype_map[btype.LEFT]:
                    # left boundary
                    dirichlet_value = bc_data
                    for i, b in enumerate(lb):
                        # The shift mirrors the interior on the same side
                        shift = cells[(i + 1) + ilo].x() - xmin
                        b.set_x(xmin - shift)

                        b.set_value(idx, dirichlet_value)

                elif dir == btype_map[btype.RIGHT]:
                    # right boundary
                    dirichlet_value = bc_data
                    for i, b in enumerate(rb):
                        # The shift mirrors the interior on the same side
                        shift = xmax - cells[ihi - (i + 1)].x()
                        b.set_x(xmax + shift)

                        b.set_value(idx, dirichlet_value)

            else:
                raise SFXM(
                    "Incorrect data specified for dictionary-type boundaries")
        else:
            raise SFXM("Boundary type not implemented")</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="splitfxm.bc.get_periodic_bcs" class="doc doc-heading">
            <code class="highlight language-python">get_periodic_bcs(bc_dict, d)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Extracts periodic boundary conditions from a boundary condition dictionary.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bc_dict</code></b>
                  (<code>dict</code>)
              –
              <div class="doc-md-description">
                <p>A dictionary where keys are component names and values are dictionaries of boundary conditions.</p>
              </div>
            </li>
            <li>
              <b><code>d</code></b>
                  (<code><a class="autorefs autorefs-internal" title="splitfxm.domain.Domain" href="../domain/#splitfxm.domain.Domain">Domain</a></code>)
              –
              <div class="doc-md-description">
                <p>An instance of the Domain class used to get the component index.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>dict</code>
              –
              <div class="doc-md-description">
                <p>A dictionary where keys are component indices and values are lists of boundary sides 
('left', 'right') that have periodic boundary conditions. Only components with periodic 
conditions are included in the output dictionary.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>splitfxm/bc.py</code></summary>
              <pre class="highlight"><code class="language-python">def get_periodic_bcs(bc_dict: dict, d: Domain):
    """
    Extracts periodic boundary conditions from a boundary condition dictionary.

    Parameters
    ----------
    bc_dict : dict
        A dictionary where keys are component names and values are dictionaries of boundary conditions. 
    d : Domain
        An instance of the Domain class used to get the component index.

    Returns
    -------
    dict
        A dictionary where keys are component indices and values are lists of boundary sides 
        ('left', 'right') that have periodic boundary conditions. Only components with periodic 
        conditions are included in the output dictionary.
    """
    periodic_bcs = {}

    for component, bcs in bc_dict.items():
        idx = d.component_index(component)
        sides = []
        for side, bc_type in bcs.items():
            if bc_type == "periodic":
                sides.append(side)

        if sides:
            periodic_bcs[idx] = sides

    return periodic_bcs</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="splitfxm.bc.extend_band" class="doc doc-heading">
            <code class="highlight language-python">extend_band(band, dirs, i, d)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Extends a list of band indices to include points affected by periodic boundary conditions.
It handles overflow points for periodic boundaries by adding indices from the left or right domain as needed.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>band</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>A list of current band indices to be extended.</p>
              </div>
            </li>
            <li>
              <b><code>dirs</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>A list of boundary directions ('left', 'right') that determine how to extend the band 
based on periodic boundary conditions.</p>
              </div>
            </li>
            <li>
              <b><code>i</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>The current point index within the domain where the band is being extended.</p>
              </div>
            </li>
            <li>
              <b><code>d</code></b>
                  (<code><a class="autorefs autorefs-internal" title="splitfxm.domain.Domain" href="../domain/#splitfxm.domain.Domain">Domain</a></code>)
              –
              <div class="doc-md-description">
                <p>An instance of the Domain class used to obtain boundary parameters such as <code>nb</code>, <code>ilo</code>, and <code>ihi</code></p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>list</code>
              –
              <div class="doc-md-description">
                <p>A new list containing the union of the original band and additional indices 
affected by periodic boundary conditions.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>splitfxm/bc.py</code></summary>
              <pre class="highlight"><code class="language-python">def extend_band(band, dirs: list, i: int, d: Domain):
    """
    Extends a list of band indices to include points affected by periodic boundary conditions.
    It handles overflow points for periodic boundaries by adding indices from the left or right domain as needed.

    Parameters
    ----------
    band : list
        A list of current band indices to be extended.
    dirs : list
        A list of boundary directions ('left', 'right') that determine how to extend the band 
        based on periodic boundary conditions.
    i : int
        The current point index within the domain where the band is being extended.
    d : Domain
        An instance of the Domain class used to obtain boundary parameters such as `nb`, `ilo`, and `ihi`

    Returns
    -------
    list
        A new list containing the union of the original band and additional indices 
        affected by periodic boundary conditions.
    """
    nb_left = d.nb(btype.LEFT)
    nb_right = d.nb(btype.RIGHT)

    ilo = d.ilo()
    ihi = d.ihi()

    # Iterate over left and right BCs
    addl_points = []
    for dir in dirs:
        # If right is periodic, check how much overflow there is
        # and add the left domain points to the band
        if dir == btype_map[btype.RIGHT]:
            overflow = max(0, nb_right - (ihi - i))
            addl_points.extend(list(range(ilo, ilo + overflow)))
        # If left is periodic, check how much overflow there is
        # and add the right domain points to the band
        elif dir == btype_map[btype.LEFT]:
            overflow = max(0, nb_left - (i - ilo))
            addl_points.extend(list(range(ihi - overflow + 1, ihi + 1)))
        else:
            raise SFXM("Incorrect boundary direction encountered")

    return list(set(band).union(set(addl_points)))</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../ic/" class="btn btn-neutral float-left" title="Initial Conditions"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../flux/" class="btn btn-neutral float-right" title="Finite-Volume Schemes">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../ic/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../flux/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
